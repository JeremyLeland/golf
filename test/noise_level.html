<link rel='stylesheet' href='../style.css'>

<body>
  <canvas id='canvas' width="10000" height="500"></canvas>
</body>

<script type='module'>
  import { Curve } from '../src/Curve.js';
  import * as Noise from '../lib/noise/2d.js';

  const noise = Noise.makeNoise2D();

  const LEVEL_HEIGHT = 500;

  const points = { top: [], mid: [], bottom: [] };

  for ( let i = 0; i < 50; i ++ ) {
    const x = i * 200;
    const mid = LEVEL_HEIGHT / 2 + noise( x * 0.01, i ) * LEVEL_HEIGHT / 3;

    points.mid.push( { x: x, y: mid } );

    const radius = Math.min( mid, LEVEL_HEIGHT - mid ) * ( 1 + noise( x * 0.01, 1 ) ) / 2;

    const top    = mid - radius;
    const bottom = mid + radius;

    points.top.unshift( { x: x, y: top } );
    points.bottom.push( { x: x, y: bottom } );
  }

  const topCurves = Curve.getCurvesThroughPoints( points.top );
  const midCurves = Curve.getCurvesThroughPoints( points.mid );
  const bottomCurves = Curve.getCurvesThroughPoints( points.bottom );

  const canvas = document.getElementById( 'canvas' );
  const ctx = canvas.getContext( '2d' );

  topCurves.forEach( curve => curve.draw( ctx ) );
  midCurves.forEach( curve => curve.draw( ctx ) );
  bottomCurves.forEach( curve => curve.draw( ctx ) );

  ctx.beginPath();
  ctx.moveTo(     0, LEVEL_HEIGHT );
  ctx.lineTo( 10000, LEVEL_HEIGHT );
  ctx.stroke();

  function octaveNoise( x, y, octaves = 1 ) {
    let total = 0;
    let frequency = 1;
    let amplitude = 1;
    let maxValue = 0;

    for ( let i = 0; i < octaves; i++ ) {
      total += noise( x * frequency, y * frequency ) * amplitude;

      maxValue += amplitude;
      amplitude *= 0.5;
      frequency *= 2.0;
    }

    return total / maxValue;
  }
  
</script>
