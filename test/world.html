<link rel='stylesheet' href='../style.css'>

<body></body>

<script type='module'>
  import { Game } from '../src/Game.js';
  import { Level } from '../src/Level.js';
  import { World } from '../src/World.js';
  import { Ball } from '../src/Ball.js';

  const ball = new Ball();
  const level = new Level();
  const world = new World();

  level.spawn( ball );
  ball.dx = 0.05; // start us moving forwards for now

  const game = new Game();

  const SENSITIVITY = 0.001;

  game.update = ( dt ) => {
    world.update( { ball: ball, walls: level.getWallsNear( ball ), dt: dt } );

    game.scrollX = window.innerWidth / 2 - ball.x;
    //game.scrollY = window.innerHeight / 2 - ball.y;

    if ( ball.isAtRest() ) {
      ball.aimAt( game.mouseX - game.scrollX, game.mouseY - game.scrollY );

      if ( game.mouseDown ) {
        ball.hit();
      }
    }
  };

  game.draw = ( ctx ) => {
    ball.draw( ctx );
    level.draw( ctx );

    // const previewDist = 1000;
    // ctx.beginPath();
    // ctx.moveTo( ball.x, ball.y );
    // ctx.lineTo( ball.x + ball.dx * previewDist, ball.y + ball.dy * previewDist );
    // ctx.strokeStyle = 'yellow';
    // ctx.stroke();

    // const hit = world.getNextHit( ball, level.getWallsNear( ball ) );
    // ctx.beginPath();
    // ctx.moveTo( ball.x, ball.y );
    // ctx.lineTo( hit.x, hit.y );
    // ctx.strokeStyle = 'red';
    // ctx.stroke();
  };

</script>