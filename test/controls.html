<link rel='stylesheet' href='../style.css'>

<body></body>

<script type='module'>
  import { Game } from '../src/Game.js';
  import { World } from '../src/World.js';
  import { Wall } from '../src/Wall.js';
  import { Ball } from '../src/Ball.js';

  const SENSITIVITY = 0.001;

  const walls = [
    new Wall( 0, 100, 100, 200 ),
    new Wall( 100, 200, 200, 200 ),
    new Wall( 200, 200, 300, 100 ),
    new Wall( 300, 100, 200, 0 ),
    new Wall( 200, 0, 100, 0 ),
    new Wall( 100, 0, 0, 100 ),
  ];

  const ball = new Ball();
  const world = new World();

  ball.x = 150;
  ball.y = 150;
  
  const game = new Game();

  let aimAngle, aimDist;

  game.update = ( dt ) => {
    world.update( { ball: ball, walls: walls, dt: dt } );

    const cx = game.mouseX - game.scrollX - ball.x;
    const cy = game.mouseY - game.scrollY - ball.y;

    aimAngle = Math.atan2( cy, cx );
    aimDist  = Math.hypot( cx, cy );
    
    if ( game.mouseDown ) {
      ball.dx += SENSITIVITY * Math.cos( aimAngle ) * aimDist;
      ball.dy += SENSITIVITY * Math.sin( aimAngle ) * aimDist;
    }
  };

  game.draw = ( ctx ) => {
    const cos = Math.cos( aimAngle ), sin = Math.sin( aimAngle );
    ctx.beginPath();
    ctx.lineTo( ball.x - sin * ball.size, ball.y + cos * ball.size );
    ctx.lineTo( ball.x + sin * ball.size, ball.y - cos * ball.size );
    ctx.lineTo( ball.x + cos * aimDist, ball.y + sin * aimDist );
    ctx.closePath();

    const gradient = ctx.createRadialGradient( ball.x, ball.y, 0, ball.x, ball.y, 100 );
    gradient.addColorStop( 0, 'green' );
    gradient.addColorStop( 0.5, 'yellow' );
    gradient.addColorStop( 1, 'red' );
    ctx.fillStyle = gradient;
    ctx.fill();

    ball.draw( ctx );
    walls.forEach( wall => wall.draw( ctx ) );
  };

</script>